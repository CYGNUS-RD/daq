<!DOCTYPE html>
<html class="mcss" lang="en">

  <head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="midas.css">
    <script src="controls.js"></script>
    <script src="midas.js"></script>
    <script src="mhttpd.js"></script>
    <script src="mhistory.js"></script>


    
    <style>
      .mtable td {
	  padding: 8px;
      }
    </style>

    <script>

      window.onload = function() {
	  
	  mhttpd_init('GasSystem');
	  mhistory_init();

      }

      var buttonTimerId = 0;

      function clear_button(){
	  
	  var paths =  ["/Equipment/GasSystem/Variables/Demand[16]","/Equipment/GasSystem/Variables/Demand[94-95]"];

	  mjsonrpc_db_paste(paths,[0,0]).then(function(rpc) {
  }).catch(function(error) {
          mjsonrpc_error_alert(error);
  });

      }

      function press_button(id){

	  if(confirm("Do you really want to operate the system?")){
	  
	      clearTimeout(buttonTimerId);
	      
	      var paths;
	      if(id===0) {
		  paths = ["/Equipment/GasSystem/Variables/Demand[94]"];
	      }
	      else if(id===1) {
		  paths = ["/Equipment/GasSystem/Variables/Demand[95]"];
	      }
	      else if(id===2) {
		  paths = ["/Equipment/GasSystem/Variables/Demand[16]"];
	      }
	      
	      mjsonrpc_db_paste(paths,[1]).then(function(rpc) {
	      }).catch(function(error) {
		  mjsonrpc_error_alert(error);
	      });
	      
	      buttonTimerId = setTimeout('clear_button()',1000);
	      
	  }
      }

/*      var updateTimerId = 0;
      var updatePeriod = 10000;
      
      function update_out(){
	  clearTimeout(updateTimerId);
	  try_out();
	  if (updatePeriod > 0)
	      updateTimerId = seTimeout('update_out()', updatePeriod);
	      }*/

      function col_fn(id_string){
	  var elem=document.getElementById(id_string) // /html/body/div[4]/table/tbody/tr[3]/td/table/tbody/tr[4]/td/table/tbody/tr[3]/td[1]/span[1]")
	  var max_val=elem.getAttribute("data-max-value")
	  var min_val=elem.getAttribute("data-min-value")
	  mjsonrpc_db_get_values([elem.getAttribute("data-odb-path") /*"/Equipment/GasSystem/Variables/Measured[265]"*/]).then(function(rpc){
	      elem.setAttribute("data-color","green")
	      var value = rpc.result.data[0]
	      if(value<0.2*max_val & value>0.10*max_val){
	  	  elem.setAttribute("data-color","yellow")
	      }
	      else if(value<0.10*max_val){
		  elem.setAttribute("data-color","red")
	      }
	      //	      if (value > 100) {
//		  document.getElementById("col").color = 'green'
//	      }
	  }).catch(function(error) {
	      mjsonrpc_error_alert(error);
	  });
//	  return "orange"
      }
      
      var counter=0;
      var sum_al = 0
      window.setInterval("try_out()",10000);      
      function try_out(){
	  mjsonrpc_db_get_values(["/Equipment/GasSystem/Variables/Measured[298-305]"]).then(function(rpc){
	      var i_val = 0
	      var j_val = 0
	      
	      document.getElementById("sum").innerHTML ='alarm n : '+ sum_al
	      var al_0 = rpc.result.data[0]
	      for(i=0;i<8;i++){
		  if(al_0[i] !=0) {
		      for(j=0; j<16; j++) {
			  if(Math.pow(2,j) == al_0[i]) {
			      i_val = i
			      j_val = j
			      sum_al = i*16+j
			      document.getElementById("sum").innerHTML ='alarm n : ' + sum_al + ','
			  }
		      }
		  }
	      }
	  }).catch(function(error) {
	      mjsonrpc_error_alert(error);
	  });
      }
      
    </script>

    <title>Gas System</title>

    
</head>

<body class="mcss">

<!--<body class="mcss" onload="mhttpd_init('GasSystem'); mhistory_init();"> -->
  <div id="mheader"></div>
  <div id="msidenav"></div>

  <div id="mmain">

    <table class="mtable">
      <tr>
	<th class="mtableheader" id="page_title" colspan="2">Gas System Control Page</th>
      </tr>


      <tr>
	<td>
	  <table class="mtable" style="float:center;width:10in">
	    <tr><th class="mtableheader" style="background-color:green" colspan="30"><b>Alarms</b></tr>      
	    <tr>
	      <td align="center"><div class="modbbox" data-odb-path="/Equipment/GasSystem/Variables/Measured[298]" data-formula="x > 0" data-color="red" data-background-color="#00FF00" style="width:20px;height:20px;border-radius:20px"></div></td>
	      <td align="center"><div class="modbbox" data-odb-path="/Equipment/GasSystem/Variables/Measured[299]" data-formula="x > 0" data-color="red" data-background-color="#00FF00" style="width:20px;height:20px;border-radius:20px"></div></td>
	      <td align="center"><div class="modbbox" data-odb-path="/Equipment/GasSystem/Variables/Measured[300]" data-formula="x > 0" data-color="red" data-background-color="#00FF00" style="width:20px;height:20px;border-radius:20px"></div></td>
	      <td align="center"><div class="modbbox" data-odb-path="/Equipment/GasSystem/Variables/Measured[301]" data-formula="x > 0" data-color="red" data-background-color="#00FF00" style="width:20px;height:20px;border-radius:20px"></div></td>
	      <td align="center"><div class="modbbox" data-odb-path="/Equipment/GasSystem/Variables/Measured[302]" data-formula="x > 0" data-color="red" data-background-color="#00FF00" style="width:20px;height:20px;border-radius:20px"></div></td>
	      <td align="center"><div class="modbbox" data-odb-path="/Equipment/GasSystem/Variables/Measured[303]" data-formula="x > 0" data-color="red" data-background-color="#00FF00" style="width:20px;height:20px;border-radius:20px"></div></td>
	      <td align="center"><div class="modbbox" data-odb-path="/Equipment/GasSystem/Variables/Measured[304]" data-formula="x > 0" data-color="red" data-background-color="#00FF00" style="width:20px;height:20px;border-radius:20px"></div></td>
	      <td align="center"><div class="modbbox" data-odb-path="/Equipment/GasSystem/Variables/Measured[305]" data-formula="x > 0" data-color="red" data-background-color="#00FF00" style="width:20px;height:20px;border-radius:20px"></div></td>
	      <td align="center"><div class="modbbox" data-odb-path="/Equipment/GasSystem/Variables/Measured[305]" data-formula="sum_al > 0" data-color="red" data-background-color="#00FF00" style="width:20px;height:20px;border-radius:20px"></div></td>

	      
	    </tr>

	     <tr>
	      <td align="center"><div class="modbvalue" data-odb-path="/Equipment/GasSystem/Variables/Measured[298]" onchange="try_out"></div></td>
	      <td align="center"><div class="modbvalue" data-odb-path="/Equipment/GasSystem/Variables/Measured[299]" onchange="try_out"></div></td>
	      <td align="center"><div class="modbvalue" data-odb-path="/Equipment/GasSystem/Variables/Measured[300]" onchange="try_out"></div></td>
	      <td align="center"><div class="modbvalue" data-odb-path="/Equipment/GasSystem/Variables/Measured[301]" onchange="try_out"></div></td>
	      <td align="center"><div class="modbvalue" data-odb-path="/Equipment/GasSystem/Variables/Measured[302]" onchange="try_out"></div></td>
	      <td align="center"><div class="modbvalue" data-odb-path="/Equipment/GasSystem/Variables/Measured[303]" onchange="try_out"></div></td>
	      <td align="center"><div class="modbvalue" data-odb-path="/Equipment/GasSystem/Variables/Measured[304]" onchange="try_out"></div></td>
	      <td align="center"><div class="modbvalue" data-odb-path="/Equipment/GasSystem/Variables/Measured[305]" onchange="try_out"></div></td>
	      <td align="center">
		<p id="sum">sum : unknown</p>
		<script> try_out() </script> 
	      </td>

	      
	    </tr>
	  </table>
	</td>
      </tr>


      <tr>
	<td>
	  <table class="mtable" style="float:left;width:10in">
	    <tr><th class="mtableheader" style="background-color:green" colspan="4"><b>Settings</b></tr>
	    <tr><td>
		<table class="mtable" style="float:center">
		  <tr><th class="mtableheader" style="background-color:lightblue;color:black" colspan="4"><b>Control</b></tr>
		  <tr>
		    <td>
		      <button class="mbutton" class="mbutton" onclick="press_button(0)"  style="padding: 7px 20px;font-size:18px;margin:5px">START</button>
		    </td>
		    <td>
		      <button class="mbutton" class="mbutton" onclick="press_button(1)" style="padding: 7px 20px;font-size:18px;margin:5px">STOP</button>
		    </td>
		    <td>
		      <button class="mbutton" class="mbutton" onclick="press_button(2)" style="padding: 7px 20px;font-size:18px;margin:5px">RESET</button>
		    </td>
		  </tr>
		</table>
		
	    </td></tr> 

	    <tr><td>
		<table class="mtable" colspan="3" style="float:center">
		  <tr height="35" style="background-color:lightblue"><th></th><th style="width:2in"><b>Demand</b></th><th style="width:2in"><b>Read</b></th></tr>
		  <tr height="35" style="font-size:\30px;font-weight:normal;text-align:center"><td style="background-color:lightblue"><b>Total Flow [sl/h]</b></td><td align="center"><div class="modbvalue" data-odb-path="/Equipment/GasSystem/Variables/Demand[107]" data-odb-editable="1"></div></td><td align="right"><div class="modbvalue"  style="font-weight:bold;color:green" data-odb-path="/Equipment/GasSystem/Variables/Measured[255]" data-format="f3" ></div></td></tr>
		  <tr height="35" style="font-size:\30px;font-weight:normal;text-align:center"><td style="background-color:lightblue"><b>Chamber Pressure [bar(a)]</b></td><td align="center" style="color:green"><div class="modbvalue" data-odb-path="/Equipment/GasSystem/Variables/Demand[115]" data-odb-editable="0" data-format="f3"></div></td><td align="right"><div class="modbvalue"  style="font-weight:bold;color:green" data-odb-path="/Equipment/GasSystem/Variables/Measured[14]" data-format="f4"></div></td></tr>
		  <tr height="35" style="font-size:\30px;font-weight:normal;text-align:center"><td style="background-color:lightblue"><b>Recirculation Flow [sl/h]</b></td><td align="center"><div class="modbvalue" data-odb-path="/Equipment/GasSystem/Variables/Demand[91]" data-odb-editable="1"></div></td><td align="right"><div class="modbvalue"  style="font-weight:bold;color:green" data-odb-path="/Equipment/GasSystem/Variables/Measured[254]" data-format="f3"></div></td></tr>
		</table>
	    </td></tr>

	    <tr><td>
		<table class="mtable" style="float:center;width:100%">
		  <tr height="35" style="background-color:lightblue"><th></th><th colspan="2">He</th><th colspan="2">CF<sub>4</sub></th><th colspan="2">SF<sub>6</sub></th></tr>
		  <tr><td style="background-color:lightblue" rowspan="2"><b>Pressure [bar(g)]</b></td>
		    <td align="center"><b>Bottle</b></td><td align="center"><b>Reducer</b></td><td align="center"><b>Bottle</b></td><td align="center"><b>Reducer</b></td><td align="center"><b>Bottle</b></td><td align="center"><b>Reducer</b></td></tr>
		  <tr>

		    <td align="center" style="vertical-align:top">
		      <span class="modbgauge" style="width:100px;height:65px;" data-odb-path="/Equipment/GasSystem/Variables/Measured[265]" data-min-value="0" data-max-value="250" data-color="darkorange" onchange="col_fn(id)" id="He_pres" data-scale="1"></span><br><span class="modbvalue" data-odb-path="/Equipment/GasSystem/Variables/Measured[265]" data-format="f1" data-formula="x"></span></td>

		    <td align="center" style="vertical-align:top">
		        <span class="modbgauge" style="width:100px;height:65px;" data-odb-path="/Equipment/GasSystem/Variables/Measured[267]" data-min-value="0" data-max-value="10" data-color="darkorange" data-scale="1"></span><br><span class="modbvalue" data-odb-path="/Equipment/GasSystem/Variables/Measured[267]" data-format="f1" data-formula="x"></span></td>
		   
		    <td align="center" style="vertical-align:top">
		      <span class="modbgauge" style="width:100px;height:65px;" data-odb-path="/Equipment/GasSystem/Variables/Measured[269]" data-min-value="0" data-max-value="170" data-color="darkorange" onchange="col_fn(id)" id="CF4_pres" data-scale="1"></span><br><span class="modbvalue" data-odb-path="/Equipment/GasSystem/Variables/Measured[269]" data-format="f1" data-formula="x"></span></td>

		    <td align="center" style="vertical-align:top">
		      <span class="modbgauge" style="width:100px;height:65px;" data-odb-path="/Equipment/GasSystem/Variables/Measured[271]" data-min-value="0" data-max-value="10" data-color="darkorange" data-scale="1"></span><br><span class="modbvalue" data-odb-path="/Equipment/GasSystem/Variables/Measured[271]" data-format="f1" data-formula="x"></span></td>

		    <td align="center" style="vertical-align:top">
		      <span class="modbgauge" style="width:100px;height:65px;" data-odb-path="/Equipment/GasSystem/Variables/Measured[273]" data-min-value="0" data-max-value="40" data-color="darkorange" onchange="col_fn(id)" id="SF6_pres" data-scale="1"></span><br><span class="modbvalue" data-odb-path="/Equipment/GasSystem/Variables/Measured[273]" data-format="f1" data-formula="x"></span></td>

		    <td align="center" style="vertical-align:top">
		      <span class="modbgauge" style="width:100px;height:65px;" data-odb-path="/Equipment/GasSystem/Variables/Measured[275]" data-min-value="0" data-max-value="10" data-color="darkorange" data-scale="1"></span><br><span class="modbvalue" data-odb-path="/Equipment/GasSystem/Variables/Measured[275]" data-format="f1" data-formula="x"></span></td>


		  </tr>
	  
		  <tr>
		    <td style="background-color:lightblue"><b>Concentration [%]</b></td>
		    <td align="center" colspan=2><span class="modbvalue" data-odb-path="/Equipment/GasSystem/Variables/Demand[102]" data-odb-editable="1"></span></td>
		    <td align="center" colspan=2><span class="modbvalue" data-odb-path="/Equipment/GasSystem/Variables/Demand[100]" data-odb-editable="1"></span></td>
		    <td align="center" colspan=2><span class="modbvalue" data-odb-path="/Equipment/GasSystem/Variables/Demand[104]" data-odb-editable="1"></span></td>
		  </tr>
		  <tr><td style="background-color:lightblue"><b>Flow [sl/h]</b></td>
		    <td align="center" style="vertical-align:top" colspan="2">
		      <span class="mvaxis" style="width:40px;height:200px;text-align:right;" data-min-value="0" data-max-value="20"></span>
		      <span class="modbvbar" style="width:30px;height:200px;color:darkorange;" data-odb-path="/Equipment/GasSystem/Variables/Measured[257]" data-min-value="0" data-max-value="20"></span>		      <br><span class="modbvalue" data-odb-path="/Equipment/GasSystem/Variables/Measured[257]" data-format="f1"></span></td>
		    
		    <td align="center" style="vertical-align:top" colspan="2">
		      <span class="mvaxis" style="width:40px;height:200px;text-align:right;" data-min-value="0" data-max-value="20"></span>
		      <span class="modbvbar" style="width:30px;height:200px;color:darkorange;" data-odb-path="/Equipment/GasSystem/Variables/Measured[259]" data-min-value="0" data-max-value="20"></span>		      <br><span class="modbvalue" data-odb-path="/Equipment/GasSystem/Variables/Measured[259]" data-format="f1"></span></td>


		    <td align="center" style="vertical-align:top" colspan="2">
		      <span class="mvaxis" style="width:40px;height:200px;text-align:right;" data-min-value="0" data-max-value="20"></span>
		      <span class="modbvbar" style="width:30px;height:200px;color:darkorange;" data-odb-path="/Equipment/GasSystem/Variables/Measured[261]" data-min-value="0" data-max-value="20"></span>		      <br>
		      <span class="modbvalue" data-odb-path="/Equipment/GasSystem/Variables/Measured[261]" data-format="f1"></span></td>

		  </tr>
		  

		</table>
	    </td></tr>
	    

	   
	    </table>

      <tr>
	<td>
	  <table class="mtable" style="float:center;width:10in">
	    <tr><th class="mtableheader" style="background-color:green" colspan="3"><b>Readings</b></tr>      
	    <tr>
	      <td>
		<table class="mtable" style="float:left;width:2.4in">
		  <tr height="35" style="background-color:lightblue"><th style="width:1.5in"><b>Atmospheric Pressure<br>[bar(a)]</b></th>
		  <tr height="35" style="font-size:\30px;font-weight:bold;text-align:center"><td style="color:green"><div class="modbvalue" data-odb-path="/Equipment/Environment/Variables/Input[3]" data-format="f3" data-formula="(x-4)/16*1.6*1.007618"></div></td></tr>

		<!Chamber information>
		<table class="mtable" style="float:left;width:2.4in">
		  <tr height="35" style="background-color:lightblue">
		    <th style="width:1.5in" colspan=2><b>Chamber Pressure [bar(a)]</b></th>
		  </tr>
		  <tr height="35" style="font-size:\30px;font-weight:normal;text-align:center"><td>PT401</td><td style="color:green"><div class="modbvalue" data-odb-path="/Equipment/GasSystem/Variables/Measured[277]" data-format="f4" data-formula="x"></div></td></tr>
		  <tr height="35" style="font-size:\30px;font-weight:normal;text-align:center"><td>PT402</td><td style="color:green"><div class="modbvalue" data-odb-path="/Equipment/GasSystem/Variables/Measured[279]" data-format="f4" data-formula="x"></div></td></tr>
		  <tr heigh="35" style="font-size:\30px;font-weight:normal;text-align:center"><td>PT403</td><td style="color:green"><div class="modbvalue" data-odb-path="/Equipment/GasSystem/Variables/Measured[281]" data-format="f4" data-formula="x"></div></td></tr>
		  <tr height="35" style="font-size:\30px;font-weight:bold;text-align:center"><td>PID</td><td style="color:green"><div class="modbvalue" data-odb-path="/Equipment/GasSystem/Variables/Measured[14]" data-format="f4" data-formula="x"></div></td></tr>
		  </tr>
		</table>
		
		<table class="mtable" style="float:left;width:2.4in">
		  <tr height="35" style="background-color:lightblue"><th style="width:1.5in" colspan=2><b>Buffers Pressure<br>[bar(g)]</b></th>
		  <tr height="35" style="font-size:\30px;font-weight:normal;text-align:center"><td>Vacuum</td><td style="color:green;font-weight:bold" ><div class="modbvalue" data-odb-path="/Equipment/GasSystem/Variables/Measured[283]" data-format="f2" data-formula="x-1."></div></td></tr>
		  <tr height="35" style="font-size:\30px;font-weight:normal;text-align:center"><td>Recirculation</td><td style="color:green;font-weight:bold"><div class="modbvalue" data-odb-path="/Equipment/GasSystem/Variables/Measured[285]" data-format="f2" data-formula="x"></div></td></tr>
		  <tr height="35" style="font-size:\30px;font-weight:normal;text-align:center"><td>Recovery</td><td style="color:green;font-weight:bold"><div class="modbvalue" data-odb-path="/Equipment/GasSystem/Variables/Measured[287]" data-format="f1" data-formula="x"></div></td></tr>
		</table>
		
		<table class="mtable" style="float:left;width:2.4in">
		  <tr height="35" style="background-color:lightblue"><th style="width:1.5in"><b>Recirculation Flow<br>[sl/h]</b></th>
		  <tr height="35" style="font-size:\30px;font-weight:bold;text-align:center"><td style="color:green"><div class="modbvalue" data-odb-path="/Equipment/GasSystem/Variables/Measured[254]" data-format="f3" data-formula="x"></div></td></tr>


		</table>

	      </td>
	    </tr>
	    
	    <tr>
	      <td>
      		<table class="mtable" style="float:left;width:2.4in">
		  <tr height="35" style="background-color:lightblue"><th style="width:1.5in"><b>Humidity Analyzer<br>[ppm]</b></th>
		  <tr height="35" style="font-size:\30px;font-weight:bold;text-align:center"><td style="color:darkorange"><div class="modbvalue" data-odb-path="/Equipment/GasSystem/Variables/Measured[251]" data-format="f1" data-formula="x"></div></td></tr>
		</table>
		<table class="mtable" style="float:left;width:2.4in">
		  <tr height="35" style="background-color:lightblue"><th style="width:1.5in"><b>Oxygen Analyzer<br>[ppm]</b></th>
		  <tr height="35" style="font-size:\30px;font-weight:bold;text-align:center"><td style="color:darkorange"><div class="modbvalue" data-odb-path="/Equipment/GasSystem/Variables/Measured[253]" data-format="f1" data-formula="x"></div></td></tr>
		</table>
	      </td>
	    </tr>
      </table>




	  <!--
	      <tr>
		<td colspan="3">
		  <table class="mtable">
		    <tr>
		      <td><div class="mjshistory" data-group="GasSystem" data-panel="Pressure" style="width:300px; height:300px;"></div></td>
		      <td><div class="mjshistory" data-group="GasSystem" data-panel="Pressure" style="width:300px; height:300px;"></div></td>
		      <td><div class="mjshistory" data-group="GasSystem" data-panel="Pressure" style="width:300px; height:300px;"></div></td>
		    </tr>
		    <tr>
		      <td><div class="mjshistory" data-group="GasSystem" data-panel="Temperature" style="width:300px; height:300px;"></div></td>
		      <td><div class="mjshistory" data-group="GasSystem" data-panel="Temperature" style="width:300px; height:300px;"></div></td>
		      <td><div class="mjshistory" data-group="GasSystem" data-panel="Temperature" style="width:300px; height:300px;"></div></td>
		    </tr>
		  </table>
		  
		</td>
	      </tr>
-->
</body>


</html>
